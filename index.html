<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lunch Roulette</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff5722">
  <link rel="icon" href="icon.png" type="image/png">

  <!-- Open Graph -->
  <meta property="og:title" content="Lunch Roulette">
  <meta property="og:description" content="점심 메뉴를 무작위로 선택해주는 룰렛 앱">
  <meta property="og:image" content="og_image.png">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://khb1986usa-creator.github.io/lunch/">

  <!-- 기존 룰렛 스타일 -->
  <style>
    body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #fff; }
    canvas { border: 2px solid #ff5722; border-radius: 50%; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 18px; cursor: pointer; background-color: #ff5722; color: #fff; border: none; border-radius: 8px; }
  </style>
</head>
<body>

<canvas id="roulette" width="400" height="400"></canvas>
<button id="spinBtn">돌리기</button>

<script>
const canvas = document.getElementById('roulette');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');

const items = ["김밥", "라면", "돈까스", "피자", "햄버거", "샐러드"];
const colors = ["#FFCDD2", "#F8BBD0", "#E1BEE7", "#BBDEFB", "#C8E6C9", "#FFF9C4"];
const numItems = items.length;

let startAngle = 0;
let spinning = false;
let spinVelocity = 0;

function drawRoulette() {
  const radius = canvas.width / 2;
  for(let i = 0; i < numItems; i++){
    const angle = startAngle + i * 2 * Math.PI / numItems;
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, angle, angle + 2 * Math.PI / numItems);
    ctx.fillStyle = colors[i];
    ctx.fill();
    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(angle + Math.PI / numItems);
    ctx.textAlign = "right";
    ctx.fillStyle = "#000";
    ctx.font = "20px Arial";
    ctx.fillText(items[i], radius - 10, 10);
    ctx.restore();
  }

  // 삼각형 표시
  ctx.fillStyle = "#ff5722";
  ctx.beginPath();
  ctx.moveTo(radius - 10, 0);
  ctx.lineTo(radius + 10, 0);
  ctx.lineTo(radius, 20);
  ctx.closePath();
  ctx.fill();
}

function animate() {
  if(spinning){
    startAngle += spinVelocity;
    spinVelocity *= 0.98;
    if(spinVelocity < 0.002){
      spinning = false;
      spinVelocity = 0;
      const index = Math.floor(((2 * Math.PI - startAngle) % (2 * Math.PI)) / (2 * Math.PI / numItems));
      alert("선택된 메뉴: " + items[index]);
    }
  }
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawRoulette();
  requestAnimationFrame(animate);
}

spinBtn.addEventListener('click', () => {
  if(!spinning){
    spinning = true;
    spinVelocity = 0.3 + Math.random() * 0.3;
  }
});

animate();

// PWA Service Worker 등록
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(reg => console.log("Service Worker 등록됨"))
    .catch(err => console.error("Service Worker 등록 실패", err));
}
</script>

</body>
</html>
